<!doctype html>
<html lang="ru">
  <link rel="stylesheet" href="styles.css">
<head>
  <script>
    fetch('/shared/logo.html')
      .then(r => r.text())
      .then(html => {
        document.head.insertAdjacentHTML('beforeend', html);
      });
  </script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã ‚Äî Ultimate Toolkit</title>

  <!-- Tailwind (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –¥–ª—è —É—Ç–∏–ª–∏—Ç –µ—Å–ª–∏ –Ω—É–∂–Ω–æ) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ====== –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏: –≤–µ—Å—å –ø—Ä–µ–º–∏—É–º-visual (–∞–Ω–∞–ª–æ–≥ styles.css + –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∫–∏) ====== -->
  <style>
.nav-pills {
}
.header {
  position: sticky;
  top: 0;
  z-index: 50;
  padding-top: 14px;
  padding-bottom: 12px;
  );

}

/* ===== Root / themes ===== */
:root{
  --bg-0:#050717; --bg-1:#071226; --bg-2:#0b1220;
  --accent-1:#8b5cf6; --accent-2:#06b6d4;
  --text:#e6eef6; --muted:rgba(230,238,252,0.6);
  --glass-1:rgba(255,255,255,0.04);
  --glass-2:rgba(255,255,255,0.02);
  --border:rgba(255,255,255,0.06);
  --radius-lg:18px;
  --font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  --font-size-base:16px;
  --panel-w:880px;
  --shadow-soft:0 16px 60px rgba(2,6,23,0.55);
  --shadow-strong:0 28px 120px rgba(2,6,23,0.66);
  --glow: 0 0 38px rgba(139,92,246,0.14);
}

/* Light theme overrides */
.light{
  --bg-0:#f6f9ff; --bg-1:#eef4ff; --bg-2:#e6edff;
  --text:#071226; --muted:#6b7280;
  --glass-1:rgba(255,255,255,0.90);
  --border:rgba(0,0,0,0.06);
  --shadow-soft:0 10px 40px rgba(16,24,40,0.06);
  --glow:0 0 30px rgba(124,58,237,0.06);
}

/* ===== Base reset and layout ===== */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:var(--font-family);
  font-size:var(--font-size-base);
  color:var(--text);
  background:
    radial-gradient(900px 500px at 10% 10%, rgba(139,92,246,0.08), transparent),
    radial-gradient(800px 420px at 90% 90%, rgba(6,182,212,0.06), transparent),
    linear-gradient(180deg,var(--bg-0),var(--bg-1) 48%, var(--bg-2));
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  overflow-x:hidden;
}

/* noise layer */
#noise{ pointer-events:none; position:fixed; inset:0; z-index:1;
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><filter id='n'><feTurbulence baseFrequency='0.85' numOctaves='2' stitchTiles='stitch'/></filter><rect width='100%' height='100%' filter='url(%23n)' opacity='0.03' fill='%23ffffff'/></svg>");
  mix-blend-mode:overlay;
}

/* animated aurora gradient */
.gradient-animated{ position:fixed; inset:0; z-index:0; pointer-events:none;
  background: linear-gradient(90deg, rgba(139,92,246,0.14), rgba(6,182,212,0.10), rgba(96,165,250,0.05));
  background-size:300% 300%; animation: gradientShift 22s linear infinite;
}
@keyframes gradientShift{ 0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%} }

/* particle canvas */
#particle-canvas{ position:fixed; inset:0; z-index:2; pointer-events:none; }

/* Container helpers */
.container{ max-width:1280px; margin:0 auto; padding:0 20px; z-index:4 }

/* ===== Glass card ===== */
.card-glass{
  position:relative;
  background: linear-gradient(180deg, var(--glass-1), rgba(255,255,255,0.02));
  border-radius:var(--radius-lg);
  border:1px solid var(--border);
  padding:18px;
  box-shadow:var(--shadow-soft);
  backdrop-filter: blur(12px) saturate(140%);
  transition: transform .38s cubic-bezier(.2,.9,.2,1), box-shadow .38s, border-color .28s;
  overflow:visible;
}
.card-glass:hover{
  transform: translateY(-10px) scale(1.012);
  box-shadow:var(--shadow-strong), var(--glow);
  border-color: rgba(255,255,255,0.12);
}

/* small heading */
.card-glass h3{ margin:0; font-size:18px; font-weight:800; color:var(--text) }
.card-glass p{ margin:0; color:var(--muted) }


.brand{ display:flex; gap:12px; align-items:center; }
.logo{ width:56px; height:56px; border-radius:14px; background: linear-gradient(135deg,var(--accent-1),var(--accent-2)); display:flex; align-items:center; justify-content:center; font-weight:900; color:white; box-shadow:0 8px 36px rgba(99,102,241,0.12); transition: transform .32s; }
.logo:hover{ transform: translateY(-6px) scale(1.04); }

/* title */
.site-title{ font-weight:800; font-size:18px }
.site-sub{ font-size:13px; color:var(--muted); margin-top:-4px }


/* head */
.display-1{ font-size:48px; font-weight:900; margin:0 0 8px; background: linear-gradient(90deg,#ffffff, rgba(255,255,255,0.9)); -webkit-background-clip:text; color:transparent; text-shadow: 0 10px 44px rgba(2,6,23,0.55); }
.lead{ color:var(--muted); font-size:17px; margin-bottom:18px }

/* CTA */
.actions{ display:flex; gap:14px; align-items:center }
.cta{ padding:12px 20px; border-radius:18px; background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); text-decoration:none; color:white; font-weight:900; box-shadow: 0 18px 54px rgba(99,102,241,0.16); display:inline-flex; gap:10px; align-items:center; transition: transform .28s; }
.cta:hover{ transform: translateY(-8px) scale(1.03) }

/* features grid used in hero */
.grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
.kv{ color:var(--muted); font-size:13px }
.h2{ font-size:18px; font-weight:800; color:var(--text) }

/* columns layout */
.columns{ display:grid; grid-template-columns:1fr 360px; gap:24px; margin:36px auto; align-items:start; max-width:1280px; padding:0 20px; }
@media (max-width:980px){ .columns{ grid-template-columns:1fr } .hero{flex-direction:column} .hero-right{ width:100% } .nav-pills{ overflow:auto } }

/* form elements */
.form-select, .input { width:100%; padding:12px; border-radius:12px; background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.04); color:var(--text); outline:none; }
.input::placeholder{ color: rgba(255,255,255,0.48) }

/* toggles */
.btn-toggle{ padding:8px 12px; border-radius:10px; background: rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.04); cursor:pointer; }

/* ===== Modals ===== */
.modal{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:80; }
.modal.hidden{ display:none; }
.modal-backdrop{ position:absolute; inset:0; backdrop-filter: blur(20px); background: linear-gradient(180deg, rgba(2,6,23,0.6), rgba(2,6,23,0.45)); }
.modal-panel{ position:relative; width:min(94vw,var(--panel-w)); max-height:88vh; overflow:auto; border-radius:var(--radius-lg); padding:22px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.06); box-shadow: var(--shadow-strong); transform-origin:center; animation: modalIn .30s cubic-bezier(.2,.9,.2,1); }
@keyframes modalIn{ from{ transform: translateY(10px) scale(.98); opacity:0 } to{ transform:none; opacity:1 } }
.modal-close{ position:absolute; top:12px; right:12px; width:36px; height:36px; border-radius:50%; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); cursor:pointer; }

/* tabs */
.tabs{ display:flex; gap:8px; flex-wrap:wrap }
.tab{ padding:10px 12px; border-radius:12px; background:transparent; border:1px solid rgba(255,255,255,0.04); cursor:pointer }
.tab.active{ background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:white; box-shadow:var(--glow) }
.tab-content{ margin-top:12px }
.tab-pane.hidden{ display:none }


/* micro animations */
.fade-up{ transform: translateY(8px); opacity:0; animation: fadeUp .6s ease forwards; }
@keyframes fadeUp{ to { transform:none; opacity:1 } }

/* small helpers */
.small-muted{ color:var(--muted); font-size:13px }
.lab{ color:var(--muted); font-weight:700; font-size:13px; margin-bottom:6px }

/* responsive tweaks */
@media (max-width:640px)

/* Smooth theme transitions */
html, body {
  transition:
    background-color 0.8s ease-in-out,
    color 0.8s ease-in-out;
}
* {
  transition:
    background-color 0.8s ease-in-out,
    color 0.8s ease-in-out,
    border-color 0.8s ease-in-out,
    box-shadow 0.8s ease-in-out;
}

/* ===== Additional wheel-specific visuals (local overrides) ===== */

:root{
  --wheel-bg-0: #061226;
  --wheel-bg-1: #071a2a;
  --panel-bg: rgba(12,18,28,0.6);
  --glass-strong: rgba(255,255,255,0.04);
  --accent-1: #7c3aed;
  --accent-2: #06b6d4;
}

/* Wheel wrapper & canvas */
.wheel-wrap {
  margin-top: 18px;
  position: relative;
  perspective: 1200px;
}


.header-inner {
  overflow-x: visible !important;
  max-width: 100%;
}
#wheel {
  border-radius: 999px;
  box-shadow:
    inset 0 -12px 40px rgba(0,0,0,0.6),
    0 18px 60px rgba(2,6,23,0.7);
  transition: box-shadow .45s ease, transform .6s cubic-bezier(.2,.9,.2,1);
  width: 100%;
  max-width: 420px;
  height: auto;
  display:block;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.02), transparent 10%), linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.06));
}

/* pointer */
.arrow-svg { filter: drop-shadow(0 8px 18px rgba(0,0,0,0.6)); transform: translateZ(0); }

/* glow while spinning */
#wheel.spinning {
  box-shadow:
    0 36px 100px rgba(124,58,237,0.18),
    inset 0 -18px 60px rgba(0,0,0,0.6);
  transform: rotateZ(0.001deg);
  filter: drop-shadow(0 20px 60px rgba(124,58,237,0.08));
}

/* Spin CTA */
#spinBtn {
  background: linear-gradient(90deg,#7c3aed,#06b6d4);
  color: white;
  border: none;
  padding: .65rem 1.05rem;
  border-radius: 12px;
  font-weight: 700;
  box-shadow: 0 12px 40px rgba(99,102,241,0.14);
  transition: transform .18s, box-shadow .18s;
}
#spinBtn:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 24px 70px rgba(99,102,241,0.18); }
#spinBtn:active { transform: translateY(1px); }

/* options list */
#optionsList input.name-input { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); color:inherit; padding:6px; border-radius:8px; width:100%; }
#optionsList input.color-input { border-radius:8px; padding:0; border:1px solid rgba(255,255,255,0.04); }

/* eliminated */
.eliminated { opacity:0.36; filter: grayscale(.35); }

/* readability for select */
select, option { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); color:inherit; border-radius:8px; padding:6px; border:1px solid rgba(255,255,255,0.04); }

/* winner */
#winner { letter-spacing: .2px; text-shadow: 0 6px 30px rgba(0,0,0,0.6); }

/* Countdown card tweaks (if reused) */
.countdown-card {
  width: 100%;
  max-width: 980px;
  margin: 30px auto 0 !important;
  padding: 34px 40px;
  transform: translateY(-26px);
  border-radius: 22px !important;
  box-shadow: 0 28px 80px rgba(0,0,0,0.26);
  backdrop-filter: blur(22px) saturate(160%);
}
.hero-left { width: 100%; display: flex; flex-direction: column; align-items: center; text-align: center; }
.hero-left p { max-width: 760px; }

/* smooth micro interactions */
.popular-pro.highlight { border-color: rgba(139,92,246,0.45) !important; box-shadow: 0 20px 60px rgba(99,102,241,0.08); }
/* ===============================
   ULTIMATE TOOLKIT ‚Äî FOOTER
   =============================== */

.ut-footer {
  margin-top: 27px;
  padding: 28px 0;
  background: rgba(255,255,255,0.02);
  border-top: 1px solid rgba(255,255,255,0.08);
  backdrop-filter: blur(14px) saturate(140%);
}

.ut-footer-inner {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 24px;
}

/* BRAND */

.ut-footer-brand {
  display: flex;
  align-items: center;
  gap: 14px;
}

.ut-footer-logo {
  width: 40px;
  height: 40px;
  border-radius: 12px;
  display: grid;
  place-items: center;
  font-weight: 800;
  font-size: 16px;
  color: #fff;
  background: linear-gradient(135deg, #7c5cff, #06b6d4);
  box-shadow:
    0 10px 28px rgba(124,92,255,0.45);
}

.ut-footer-text {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.ut-footer-title {
  font-size: 16px;
  font-weight: 600;
}

.ut-footer-copy {
  font-size: 12.5px;
  opacity: .6;
}

/* LINKS */

.ut-footer-links {
  display: flex;
  gap: 22px;
}

.ut-footer-links a {
  font-size: 14.5px;
  font-weight: 500;
  text-decoration: none;
  opacity: .75;
  color: var(--text-main);
  transition:
    opacity .25s ease,
    transform .25s ease;
color: color-mix(in oklab, var(--text-main) 88%, #7c5cff);

}

.ut-footer-links a:hover {
  opacity: 1;
  transform: translateY(-1px);
}
.nav-double {
  gap: 9px;
}

.nav-row {
  display: flex;
  gap: 9px;
}


/* pills –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ */
.nav-pills a {
  padding: 10px 16px;
  border-radius: 14px;
  font-weight: 600;
  white-space: nowrap;
}
  </style>
</head>
<body>

  <!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å–ª–æ–∏ -->
  <div id="noise" aria-hidden="true"></div>
  <div class="gradient-animated" aria-hidden="true"></div>
  <canvas id="particle-canvas" aria-hidden="true"></canvas>

  <!-- HEADER -->
  <header class="header" role="banner" aria-label="–ì–ª–∞–≤–Ω–∞—è —à–∞–ø–∫–∞">
    <div class="header-inner container">
      <div class="brand">
        <div class="logo" aria-hidden="true">UT</div>
        <div>
          <div class="site-title">Ultimate Toolkit</div>
          <div class="site-sub">		–ß–∞—Å—ã ¬∑ –ù–∏–∫–Ω–µ–π–º—ã ¬∑ –ü–∞—Ä–æ–ª–∏ ¬∑ –†–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä ¬∑ –ö–æ–ª–µ—Å–æ ¬∑ –î–∞—Ç—ã</div>          
        </div>
      </div>

<nav class="nav-pills nav-double" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
  <div class="nav-row">
    <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="timer.html">–ß–∞—Å—ã</a>
    <a href="nick.html">–ù–∏–∫–Ω–µ–π–º—ã</a>
    <a href="password.html">–ü–∞—Ä–æ–ª–∏</a>
    <a href="random.html">–†–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä</a>
  </div>
  <div class="nav-row nav-row-sub">
    <a href="wheel.html" class="active">–ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã</a>
    <a href="countdown.html">–û—Ç—á—ë—Ç –¥–æ –¥–∞—Ç—ã</a>
  </div>
</nav>

      <div class="header-actions" role="toolbar" aria-label="–î–µ–π—Å—Ç–≤–∏—è">
        <button id="themeBtn" class="icon-btn" aria-pressed="false" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">üåô</button>
        <button id="settingsBtn" class="icon-btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
      </div>
    </div>
  </header>


  <!-- MAIN -->
  <main class="max-w-6xl mx-auto p-6">
    <div class="flex flex-wrap gap-8 justify-center">

      <!-- LEFT: wheel -->
      <div class="wheel-wrap panel relative w-[520px] flex flex-col items-center" style="margin-top:44px;">
        <!-- pointer -->
        <div style="position:absolute; top:-78px; left:50%; transform:translateX(-50%);" aria-hidden="true">
          <svg class="arrow-svg" width="84" height="84" viewBox="0 0 100 100" aria-hidden="true">
            <polygon points="50,90 18,22 82,22"
                     fill="none" stroke="#ff6b6b" stroke-width="5" stroke-linejoin="round"/>
          </svg>
        </div>

        <canvas id="wheel" width="420" height="420"></canvas>

        <div class="mt-6 flex items-center">
          <button id="spinBtn" class="px-6 py-2 rounded-lg">–ö—Ä—É—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ</button>
          <button id="resetEliminated" class="reset-btn hidden ml-3" title="–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–±—ã–≤—à–∏–µ">‚ü≥</button>
        </div>

        <div id="winner" class="mt-4 text-yellow-300 text-lg font-bold">–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ‚Äî</div>
      </div>

      <!-- RIGHT: panel -->
      <div class="panel w-96">
        <div class="mb-4">
          <label class="text-sm block mb-1 font-semibold">–†–µ–∂–∏–º</label>
          <select id="modeSelect" class="w-full p-2 bg-slate-700 rounded">
            <option value="single">–û–¥–∏–Ω –ø–æ–±–µ–¥–∏—Ç–µ–ª—å</option>
            <option value="elimination">–í—ã–±—ã–≤–∞–Ω–∏–µ</option>
          </select>
        </div>

        <h3 class="text-xl mb-3 font-semibold">–í–∞—Ä–∏–∞–Ω—Ç—ã</h3>

        <table id="optionsList" class="w-full text-sm"></table>

        <div class="mt-3">
          <input id="newText" type="text" placeholder="–ù–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç" class="w-full p-2 rounded bg-slate-700 mb-2" />
          <input id="newColor" type="color" value="#f87171" class="w-full h-10 p-1 mb-2" />
          <button id="addBtn" class="w-full bg-teal-600 hover:bg-teal-700 p-2 rounded font-medium">–î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</button>
        </div>

        <div class="mt-4">
          <label class="text-sm">–í—Ä–µ–º—è –≤—Ä–∞—â–µ–Ω–∏—è (—Å–µ–∫):</label>
          <input id="spinTime" type="number" value="5" min="1" max="30" class="w-full p-2 mt-1 bg-slate-700 rounded" />
        </div>

        <div id="info" class="mt-4 text-sm text-slate-300">
          –í —Ä–µ–∂–∏–º–µ ¬´–í—ã–±—ã–≤–∞–Ω–∏–µ¬ª –≤—ã–ø–∞–≤—à–∏–π —Å–µ–∫—Ç–æ—Ä –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è –∏–∑ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤—Ä–∞—â–µ–Ω–∏—è –∏ –∑–∞—Ç–µ–º–Ω—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ.
        </div>
      </div>

    </div>
  </main>

 <footer class="ut-footer">
  <div class="ut-footer-inner container">

    <!-- LEFT: BRAND -->
    <div class="ut-footer-brand">
      <div class="ut-footer-logo">UT</div>
      <div class="ut-footer-text">
        <div class="ut-footer-title">Ultimate Toolkit</div>
        <div class="ut-footer-copy">
          ¬© 2026<span id="footerYear"></span>
        </div>
      </div>
    </div>

    <!-- RIGHT: LINKS -->
    <div class="ut-footer-links">
      <a href="feedback.html">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</a>
      <a href="privacy.html">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
    </div>

  </div>
</footer>


  <!-- SETTINGS MODAL -->
  <div id="settingsModal" class="modal hidden" role="dialog" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-panel settings-panel card-glass" role="document" aria-labelledby="settingsTitle">
      <button class="modal-close" id="settingsClose" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úñ</button>
      <h3 id="settingsTitle">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>

      <div class="tabs" style="display:flex;gap:8px;margin-top:12px">
        <button class="tab" data-tab="personal">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è</button>
        <button class="tab" data-tab="export">–≠–∫—Å–ø–æ—Ä—Ç</button>
      </div>

      <div class="tab-content" style="margin-top:12px">


        <!-- PERSONAL -->
        <div class="tab-pane hidden" data-pane="personal">
          <h4>–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h4>
          <div class="section">
            <label>–¢–µ–º–∞</label>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="themeLight" class="btn-toggle">–°–≤–µ—Ç–ª–∞—è</button>
              <button id="themeDark" class="btn-toggle">–¢—ë–º–Ω–∞—è</button>
            </div>

            <label style="margin-top:12px">–†–∞–∑–º–µ—Ä UI</label>
            <select id="fontSizePanel" class="form-select" style="margin-top:8px">
              <option value="15">15px</option>
              <option value="16" selected>16px</option>
              <option value="18">18px</option>
              <option value="20">20px</option>
            </select>

            <div style="display:flex;gap:8px;margin-top:12px">
              <button id="particlesPanelToggle" class="btn-toggle">–ß–∞—Å—Ç–∏—Ü—ã</button>
              <button id="reducedMotionToggle" class="btn-toggle">Reduced motion</button>
            </div>

            <label style="margin-top:12px">UI –ø–ª–æ—Ç–Ω–æ—Å—Ç—å</label>
            <select id="uiDensity" class="form-select">
              <option value="compact">–ö–æ–º–ø–∞–∫—Ç</option>
              <option value="normal" selected>–û–±—ã—á–Ω–∞—è</option>
              <option value="comfortable">–ö–æ–º—Ñ–æ—Ä—Ç</option>
            </select>
          </div>
        </div>


        <!-- EXPORT / IMPORT -->
        <div class="tab-pane hidden" data-pane="export">
          <h4>–≠–∫—Å–ø–æ—Ä—Ç / –ò–º–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫</h4>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="exportBtn" class="btn-primary" style="flex:1">–≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</button>
            <button id="importBtn" class="btn-ghost" style="flex:1">–ò–º–ø–æ—Ä—Ç (–≤—Å—Ç–∞–≤–∏—Ç—å JSON)</button>
          </div>
          <textarea id="importArea" placeholder='–í—Å—Ç–∞–≤—å JSON –∏ –Ω–∞–∂–º–∏ "–ò–º–ø–æ—Ä—Ç"' style="width:100%;height:120px;margin-top:10px;padding:10px;border-radius:8px;background:transparent;border:1px solid var(--border);color:inherit"></textarea>
          <div class="small-muted" style="margin-top:8px">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∏–º–ø–æ—Ä—Ç –ø—Ä–∏–º–µ–Ω–∏—Ç –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –ª–æ–∫–∞–ª—å–Ω–æ.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== UI.JS ‚Äî –ø—Ä–µ–º–∏—É–º UI logic (–≤—Å—Ç—Ä–æ–µ–Ω) ===== -->
  <script>
(function () {
  'use strict';
  const doc = document;
  const root = doc.documentElement;

  // Elements
  const themeBtn = doc.getElementById('themeBtn');
  const settingsBtn = doc.getElementById('settingsBtn');

  const settingsModal = doc.getElementById('settingsModal');
  const settingsClose = doc.getElementById('settingsClose');

  const yearEl = doc.getElementById('year');

  // Controls inside settings
  const tabButtons = Array.from(doc.querySelectorAll('.tab'));
  const tabPanes = Array.from(doc.querySelectorAll('.tab-pane'));

  // quick controls
  const fontSizeSelect = doc.getElementById('fontSize');
  const particlesBtn = doc.getElementById('toggleParticles');
  const soundsBtn = doc.getElementById('toggleSounds');

  // panel controls
  const themeLightBtn = doc.getElementById('themeLight');
  const themeDarkBtn = doc.getElementById('themeDark');
  const fontSizePanel = doc.getElementById('fontSizePanel');
  const particlesPanelToggle = doc.getElementById('particlesPanelToggle');
  const reducedMotionToggle = doc.getElementById('reducedMotionToggle');
  const saveAccountBtn = doc.getElementById('saveAccount');
  const resetAccountBtn = doc.getElementById('resetAccount');
  const accName = doc.getElementById('accName');
  const accEmail = doc.getElementById('accEmail');

  const exportBtn = doc.getElementById('exportBtn');
  const importBtn = doc.getElementById('importBtn');
  const importArea = doc.getElementById('importArea');



  // Particles canvas
  const canvas = doc.getElementById('particle-canvas');
  const ctx = canvas && canvas.getContext ? canvas.getContext('2d') : null;
  let particles = [];
  let particleEnabled = localStorage.getItem('ut_particles') !== 'false';
  let raf = null;

  // Year
  if (yearEl) yearEl.textContent = new Date().getFullYear();

  // Helpers: save/load settings
  function getDefaultSettings(){
    return {
      theme: localStorage.getItem('ut_theme') || 'dark',
      fontSize: localStorage.getItem('ut_font') || '16',
      particles: localStorage.getItem('ut_particles') !== 'false',
      sounds: localStorage.getItem('ut_sounds') === 'true',
      reducedMotion: localStorage.getItem('ut_reduced') === 'true',
      uiDensity: localStorage.getItem('ut_density') || 'normal',
      account: JSON.parse(localStorage.getItem('ut_account') || '{}'),
      security: {
        twoFA: localStorage.getItem('ut_2fa') === 'true',
        sessionLock: localStorage.getItem('ut_lock') === 'true'
      },
      notify: {
        push: localStorage.getItem('ut_push') === 'true',
        mail: localStorage.getItem('ut_mail') === 'true'
      }
    };
  }
  let settings = getDefaultSettings();

  // Apply theme
  function applyTheme(theme){
    if(theme === 'light') root.classList.add('light');
    else root.classList.remove('light');
    localStorage.setItem('ut_theme', theme);
    if(themeBtn) themeBtn.textContent = theme === 'light' ? '‚òÄÔ∏è' : 'üåô';
    settings.theme = theme;
  }
  applyTheme(settings.theme);

  // Apply font size
  function applyFontSize(px){
    root.style.setProperty('--font-size-base', px + 'px');
    localStorage.setItem('ut_font', px);
    if (fontSizeSelect) fontSizeSelect.value = px;
    if (fontSizePanel) fontSizePanel.value = px;
    settings.fontSize = px;
  }
  applyFontSize(settings.fontSize);

  // Reduced motion
  function applyReducedMotion(on){
    if(on) root.classList.add('reduced-motion'); else root.classList.remove('reduced-motion');
    localStorage.setItem('ut_reduced', on ? 'true' : 'false');
    settings.reducedMotion = on;
  }
  applyReducedMotion(settings.reducedMotion);

  // UI density
  function applyDensity(value){
    document.body.dataset.density = value;
    localStorage.setItem('ut_density', value);
    settings.uiDensity = value;
  }
  applyDensity(localStorage.getItem('ut_density') || 'normal');

  // Particles implementation
  function resizeCanvas(){
    if(!canvas || !ctx) return;
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    canvas.width = Math.floor(innerWidth * dpr);
    canvas.height = Math.floor(innerHeight * dpr);
    canvas.style.width = innerWidth + 'px';
    canvas.style.height = innerHeight + 'px';
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  function createParticles(count = 88){
    particles = [];
    for(let i=0;i<count;i++){
      particles.push({
        x: Math.random()*innerWidth,
        y: Math.random()*innerHeight,
        r: 0.6 + Math.random()*4.4,
        vx: (Math.random()-0.5)*0.6,
        vy: (Math.random()-0.5)*0.6,
        hue: 170 + Math.random()*150,
        a: 0.03 + Math.random()*0.08
      });
    }
  }
  createParticles(88);

  function drawParticles(){
    if(!canvas || !ctx) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(!particleEnabled) return;
    for(const p of particles){
      p.x += p.vx; p.y += p.vy;
      if(p.x < -40) p.x = innerWidth + 40; if(p.x > innerWidth + 40) p.x = -40;
      if(p.y < -40) p.y = innerHeight + 40; if(p.y > innerHeight + 40) p.y = -40;
      const g = ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r*8);
      g.addColorStop(0, `hsla(${p.hue},85%,64%,${p.a})`);
      g.addColorStop(0.6, `hsla(${p.hue},70%,50%,${p.a*0.4})`);
      g.addColorStop(1, `hsla(${p.hue},60%,40%,0)`);
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r*8,0,Math.PI*2);
      ctx.fill();
    }
    raf = requestAnimationFrame(drawParticles);
  }

  function startParticles(){
    particleEnabled = true; localStorage.setItem('ut_particles','true'); settings.particles = true;
    if(!raf) drawParticles();
  }
  function stopParticles(){
    particleEnabled = false; localStorage.setItem('ut_particles','false'); settings.particles = false;
    if(raf) { cancelAnimationFrame(raf); raf = null; ctx && ctx.clearRect(0,0,canvas.width,canvas.height); }
  }
  if(settings.particles) drawParticles();

  // Toggle handlers
  themeBtn?.addEventListener('click', ()=> applyTheme(root.classList.contains('light') ? 'dark' : 'light'));
  themeLightBtn?.addEventListener('click', ()=> applyTheme('light'));
  themeDarkBtn?.addEventListener('click', ()=> applyTheme('dark'));

  fontSizeSelect?.addEventListener('change', e => applyFontSize(e.target.value));
  fontSizePanel?.addEventListener('change', e => applyFontSize(e.target.value));

  particlesBtn?.addEventListener('click', ()=> {
    particleEnabled = !particleEnabled;
    if(particleEnabled) startParticles(); else stopParticles();
    if(particlesBtn) particlesBtn.classList.toggle('active', particleEnabled);
  });
  particlesPanelToggle?.addEventListener('click', ()=> {
    particleEnabled = !particleEnabled;
    if(particleEnabled) startParticles(); else stopParticles();
    particlesPanelToggle.classList.toggle('active', particleEnabled);
  });

  reducedMotionToggle?.addEventListener('click', ()=> {
    settings.reducedMotion = !settings.reducedMotion;
    applyReducedMotion(settings.reducedMotion);
  });

  function applyReducedMotion(on){
    if(on) root.classList.add('reduced-motion'); else root.classList.remove('reduced-motion');
    localStorage.setItem('ut_reduced', on ? 'true' : 'false');
  }

  // Tabs logic (settings)
  tabButtons.forEach(btn => {
    btn.addEventListener('click', ()=> {
      tabButtons.forEach(b => b.classList.toggle('active', b === btn));
      const target = btn.dataset.tab;
      tabPanes.forEach(p => p.classList.toggle('hidden', p.dataset.pane !== target));
    });
  });

  // Modals: open only by buttons (not visible by default)
  function openModal(modal){
    if(!modal) return;
    modal.classList.remove('hidden');
    modal.style.display = 'flex';
    modal.setAttribute('aria-hidden','false');
    document.body.style.overflow = 'hidden';
    const f = modal.querySelector('input,button,select,textarea');
    if(f) setTimeout(()=> f.focus(), 120);
  }
  function closeModal(modal){
    if(!modal) return;
    modal.classList.add('hidden');
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden','true');
    document.body.style.overflow = '';
  }

  // Wire buttons
  settingsBtn?.addEventListener('click', ()=> openModal(settingsModal));
  settingsClose?.addEventListener('click', ()=> closeModal(settingsModal));
  doc.querySelectorAll('[data-close="true"]').forEach(el => el.addEventListener('click', ()=> { closeModal(settingsModal); closeModal(authModal); }));

  // Close on escape
  window.addEventListener('keydown', e => {
    if(e.key === 'Escape'){
      closeModal(settingsModal);
    }
  });



  // Export / Import
  exportBtn?.addEventListener('click', ()=> {
    const toExport = {
      theme: settings.theme,
      fontSize: settings.fontSize,
      particles: settings.particles,
      sounds: settings.sounds,
      reducedMotion: settings.reducedMotion,
      uiDensity: settings.uiDensity,
      account: settings.account,
      security: settings.security,
      notify: settings.notify
    };
    const blob = new Blob([JSON.stringify(toExport, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = doc.createElement('a'); a.href = url; a.download = 'ut_settings.json'; a.click(); URL.revokeObjectURL(url);
  });

  importBtn?.addEventListener('click', ()=> {
    try {
      const data = JSON.parse(importArea.value);
      if(!data) throw new Error('–ü—É—Å—Ç–æ–π JSON');
      if(data.theme) applyTheme(data.theme);
      if(data.fontSize) applyFontSize(data.fontSize);
      if(typeof data.particles !== 'undefined'){ data.particles ? startParticles() : stopParticles(); }
      if(typeof data.sounds !== 'undefined'){ settings.sounds = !!data.sounds; localStorage.setItem('ut_sounds', settings.sounds ? 'true' : 'false'); }
      if(typeof data.reducedMotion !== 'undefined'){ applyReducedMotion(!!data.reducedMotion); }
      if(data.uiDensity) applyDensity(data.uiDensity);
      if(data.account) { settings.account = data.account; localStorage.setItem('ut_account', JSON.stringify(data.account)); accName.value = data.account.name || ''; accEmail.value = data.account.email || ''; }
      if(data.security){ settings.security = data.security; localStorage.setItem('ut_2fa', data.security.twoFA ? 'true':'false'); twoFAToggle.checked = !!data.security.twoFA; }
      if(data.notify){ settings.notify = data.notify; localStorage.setItem('ut_push', data.notify.push ? 'true':'false'); pushToggle.checked = !!data.notify.push; }
      alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.');
    } catch(err){
      alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ' + err.message);
    }
  });



  // Fill UI from settings on load
  function hydrateUI(){
    if(fontSizeSelect) fontSizeSelect.value = settings.fontSize;
    if(fontSizePanel) fontSizePanel.value = settings.fontSize;
    if(particlesBtn) particlesBtn.classList.toggle('active', settings.particles);
    if(soundsBtn) soundsBtn.classList.toggle('active', settings.sounds);
    if(particlesPanelToggle) particlesPanelToggle.classList.toggle('active', settings.particles);
    if(twoFAToggle) twoFAToggle.checked = settings.security.twoFA;
    if(sessionLockToggle) sessionLockToggle.checked = settings.security.sessionLock;
    if(pushToggle) pushToggle.checked = settings.notify && settings.notify.push;
    if(mailToggle) mailToggle.checked = settings.notify && settings.notify.mail;
    if(settings.account){ accName.value = settings.account.name || ''; accEmail.value = settings.account.email || ''; }
  }
  hydrateUI();

  // Ensure modals are hidden initially
  closeModal(settingsModal);
  closeModal(authModal);

  // micro-interaction: press animation
  doc.addEventListener('pointerdown', e => {
    const el = e.target.closest('button, a');
    if(!el) return;
    el.animate([{ transform: 'scale(.995)' }, { transform: 'scale(1)' }], { duration: 140, easing: 'cubic-bezier(.2,.9,.2,1)' });
  });

  // convenience: save settings on unload
  window.addEventListener('beforeunload', ()=> {
    localStorage.setItem('ut_settings_snapshot', JSON.stringify({
      theme: settings.theme,
      fontSize: settings.fontSize,
      particles: settings.particles,
      sounds: settings.sounds,
      reducedMotion: settings.reducedMotion,
      uiDensity: settings.uiDensity,
      account: settings.account,
      security: settings.security,
      notify: settings.notify
    }));
  });

})();
  </script>

  <!-- ===== Wheel logic (kept logic intact; enhanced visuals) ===== -->
  <script>
/* ====== STATE & DOM ====== */
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');

let options = [
  { name: "–í–∞—Ä–∏–∞–Ω—Ç 1", color: "#ef4444" },
  { name: "–í–∞—Ä–∏–∞–Ω—Ç 2", color: "#10b981" },
  { name: "–í–∞—Ä–∏–∞–Ω—Ç 3", color: "#60a5fa" },
  { name: "–í–∞—Ä–∏–∞–Ω—Ç 4", color: "#f59e0b" }
];

let eliminated = new Set();
let spinning = false;
let rotationRad = 0;

const optionsList = document.getElementById('optionsList');
const addBtn = document.getElementById('addBtn');
const newText = document.getElementById('newText');
const newColor = document.getElementById('newColor');
const spinBtn = document.getElementById('spinBtn');
const winnerBox = document.getElementById('winner');
const spinTime = document.getElementById('spinTime');
const modeSelect = document.getElementById('modeSelect');
const resetEliminated = document.getElementById('resetEliminated');

/* ====== helpers ====== */
function getActiveIndices(){
  const arr = [];
  for(let i=0;i<options.length;i++){
    if(!eliminated.has(i)) arr.push(i);
  }
  return arr;
}

/* ====== DRAW WHEEL ‚Äî enhanced visuals (keeps selection logic intact) ====== */
function drawWheel(rot=0){
  const displaySize = 420;
  const cx = displaySize/2, cy = displaySize/2, r = Math.min(cx,cy)-6;
  // clear high-DPI scaled canvas by using style-size
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Draw outer soft vignette
  const bgGrad = ctx.createRadialGradient(cx, cy, r*0.05, cx, cy, r*1.1);
  bgGrad.addColorStop(0, 'rgba(255,255,255,0.02)');
  bgGrad.addColorStop(0.15, 'rgba(255,255,255,0.01)');
  bgGrad.addColorStop(1, 'rgba(0,0,0,0.16)');
  ctx.beginPath();
  ctx.arc(cx,cy,r+6,0,Math.PI*2);
  ctx.fillStyle = bgGrad;
  ctx.fill();

  const active = getActiveIndices();
  const n = active.length;
  if(n===0){
    ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.fillStyle='rgba(255,255,255,0.02)'; ctx.fill();
    ctx.fillStyle='#94a3b8'; ctx.font='16px Inter'; ctx.textAlign='center'; ctx.fillText('–ù–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤',cx,cy);
    return;
  }
  const step = 2*Math.PI / n;

  for(let a=0;a<n;a++){
    const optIndex = active[a];
    const opt = options[optIndex];
    const start = a*step + rot;
    const end = start + step;

    // sector gradient
    const midAngle = start + step/2;
    const gx = cx + Math.cos(midAngle) * r * 0.28;
    const gy = cy + Math.sin(midAngle) * r * 0.28;
    const grad = ctx.createLinearGradient(gx, gy, cx, cy);
    grad.addColorStop(0, shadeColor(opt.color, 14));
    grad.addColorStop(0.6, opt.color);
    grad.addColorStop(1, shadeColor(opt.color, -8));

    ctx.beginPath(); ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,r,start,end);
    ctx.closePath();
    ctx.fillStyle = grad;
    ctx.fill();

    // inner separator stroke
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,r,start,start+0.0001);
    ctx.lineTo(cx,cy);
    ctx.fillStyle = 'rgba(0,0,0,0.08)';
    ctx.fill();

    // Label
    ctx.save();
    ctx.translate(cx,cy);
    ctx.rotate(start + step/2);
    ctx.textAlign = 'right';
    ctx.fillStyle = '#fff';
    ctx.font = '700 16px Inter';
    // stroke for legibility
    ctx.lineWidth = 3;
    ctx.strokeStyle = 'rgba(0,0,0,0.55)';
    ctx.strokeText(opt.name, r - 18, 6);
    ctx.fillText(opt.name, r - 18, 6);
    ctx.restore();
  }

  // inner glossy ring
  ctx.beginPath();
  ctx.arc(cx,cy, r*0.18, 0, Math.PI*2);
  const innerGrad = ctx.createRadialGradient(cx,cy,r*0.02,cx,cy,r*0.18);
  innerGrad.addColorStop(0, 'rgba(255,255,255,0.06)');
  innerGrad.addColorStop(1, 'rgba(0,0,0,0.25)');
  ctx.fillStyle = innerGrad;
  ctx.fill();

  // center subtle circle
  ctx.beginPath();
  ctx.arc(cx,cy, 40, 0, Math.PI*2);
  ctx.fillStyle = 'rgba(255,255,255,0.02)';
  ctx.fill();

  // bevel outline
  ctx.beginPath();
  ctx.arc(cx,cy, r+4, 0, Math.PI*2);
  ctx.strokeStyle = 'rgba(255,255,255,0.03)';
  ctx.lineWidth = 2;
  ctx.stroke();
}

/* shade color helper */
function shadeColor(hex, percent) {
  const f = hex.slice(1);
  const t = percent < 0 ? 0 : 255;
  const p = Math.abs(percent) / 100;
  const R = parseInt(f.substring(0,2),16);
  const G = parseInt(f.substring(2,4),16);
  const B = parseInt(f.substring(4,6),16);
  const newR = Math.round((t - R) * p) + R;
  const newG = Math.round((t - G) * p) + G;
  const newB = Math.round((t - B) * p) + B;
  return `rgb(${newR}, ${newG}, ${newB})`;
}

/* ====== OPTIONS UI ====== */
function renderOptionsList(){
  optionsList.innerHTML = '';
  options.forEach((opt, idx)=>{
    const tr = document.createElement('tr');
    tr.className = 'align-middle';
    if(eliminated.has(idx)) tr.classList.add('eliminated');

    tr.innerHTML = `
      <td class="p-1 pr-2" style="width:40px">
        <input data-i="${idx}" type="color" value="${opt.color}" class="color-input w-8 h-8 rounded">
      </td>
      <td class="p-1">
        <input data-i="${idx}" type="text" value="${opt.name}" class="name-input w-full p-1 rounded bg-slate-700">
      </td>
      <td class="p-1 pl-2" style="width:36px">
        <button data-i="${idx}" class="remove-btn text-red-400 font-bold">‚úñ</button>
      </td>
    `;
    optionsList.appendChild(tr);
  });

  // listeners
  optionsList.querySelectorAll('.color-input').forEach(inp=>{
    inp.addEventListener('input', e=>{
      const i = Number(e.target.dataset.i);
      options[i].color = e.target.value;
      drawWheel(rotationRad);
    });
  });
  optionsList.querySelectorAll('.name-input').forEach(inp=>{
    inp.addEventListener('input', e=>{
      const i = Number(e.target.dataset.i);
      options[i].name = e.target.value;
      drawWheel(rotationRad);
    });
  });
  optionsList.querySelectorAll('.remove-btn').forEach(btn=>{
    btn.addEventListener('click', e=>{
      const i = Number(e.target.dataset.i);
      options.splice(i,1);
      const newEl = new Set();
      for(const id of eliminated){
        if(id < i) newEl.add(id);
        else if(id > i) newEl.add(id-1);
      }
      eliminated = newEl;
      renderOptionsList();
      drawWheel(rotationRad);
    });
  });
}

/* ====== MODE UI ====== */
function updateModeUI(){
  if(modeSelect.value === 'elimination'){
    resetEliminated.classList.toggle('hidden', eliminated.size===0);
  } else {
    resetEliminated.classList.add('hidden');
  }
}
modeSelect.addEventListener('change', ()=> {
  updateModeUI();
  drawWheel(rotationRad);
});

addBtn.addEventListener('click', ()=>{
  const name = newText.value.trim();
  if(!name) return;
  options.push({name, color: newColor.value});
  newText.value = '';
  renderOptionsList();
  drawWheel(rotationRad);
});

resetEliminated.addEventListener('click', ()=>{
  eliminated.clear();
  resetEliminated.classList.add('hidden');
  renderOptionsList();
  drawWheel(rotationRad);
});

/* ====== Winner determination ====== */
function finishSpin(finalRotation){
  rotationRad = finalRotation % (2*Math.PI);
  if(rotationRad < 0) rotationRad += 2*Math.PI;

  drawWheel(rotationRad);

  const active = getActiveIndices();
  const n = active.length;
  if(n === 0){
    winnerBox.textContent = "–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ‚Äî";
    spinning = false;
    canvas.classList.remove('spinning');
    return;
  }

  const step = 2*Math.PI / n;
  const pointerAngle = -Math.PI / 2;

  let minDiff = Infinity;
  let winnerActiveIndex = 0;

  for(let a = 0; a < n; a++){
    let center = a * step + rotationRad + step / 2;
    center = (center + 2 * Math.PI) % (2 * Math.PI);
    let diff = Math.abs(Math.atan2(Math.sin(center - pointerAngle), Math.cos(center - pointerAngle)));
    if(diff < minDiff){
      minDiff = diff;
      winnerActiveIndex = a;
    }
  }

  const winnerOriginalIndex = active[winnerActiveIndex];
  const winner = options[winnerOriginalIndex];

  winnerBox.textContent = "–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: " + winner.name;

  if(modeSelect.value === "elimination"){
    eliminated.add(winnerOriginalIndex);
    resetEliminated.classList.remove("hidden");
  }

  renderOptionsList();
  drawWheel(rotationRad);
  spinning = false;
  canvas.classList.remove('spinning');
}

/* ====== Spin animation ====== */
function spin(){
  const active = getActiveIndices();
  if(spinning) return;
  if(active.length === 0){
    winnerBox.textContent = '–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ‚Äî (–Ω–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)';
    return;
  }
  spinning = true;
  winnerBox.textContent = '...';

  canvas.classList.add('spinning');

  const duration = Math.max(800, Number(spinTime.value) * 1000);
  const start = performance.now();
  const extra = (Math.random()*4 + 6) * 2*Math.PI;
  const from = rotationRad;
  const to = rotationRad + extra;

  function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

  function frame(now){
    const elapsed = now - start;
    const t = Math.min(1, elapsed / duration);
    const eased = easeOutCubic(t);
    const current = from + (to - from) * eased;
    drawWheel(current);
    if(t < 1) requestAnimationFrame(frame);
    else finishSpin(to);
  }
  requestAnimationFrame(frame);
}

/* listeners */
spinBtn.addEventListener('click', spin);
document.addEventListener('keydown', e => { if(e.key === ' '){ e.preventDefault(); spin(); } });

/* initial render */
renderOptionsList();
drawWheel(rotationRad);
updateModeUI();

/* DPR resize */
(function resizeCanvasForDPR(){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  const size = 420;
  canvas.width = size * dpr;
  canvas.height = size * dpr;
  canvas.style.width = size + 'px';
  canvas.style.height = size + 'px';
  ctx.setTransform(dpr,0,0,dpr,0,0);
  drawWheel(rotationRad);
})();

(function quickFallbackHeader(){


  theme && theme.addEventListener('click', () => {

  });

  settings && settings.addEventListener('click', () => {
    if(settingsModal) { settingsModal.classList.remove('hidden'); settingsModal.style.display='flex'; document.body.style.overflow='hidden'; }
  });
;

  document.querySelectorAll('.modal-backdrop').forEach(b => b && b.addEventListener('click', ()=>{
    const parent = b.parentElement;
    if(parent) { parent.classList.add('hidden'); parent.style.display='none'; parent.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }
  }));
})();
  </script>

  <script>
    // ensure year element is filled
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
<script>
(function(){
  const btn = document.getElementById('themeToggle');
  if(!btn) return;

  const root = document.documentElement;

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π —Ç–µ–º—ã
  if(saved === 'light'){
    root.classList.add('light');
    btn.textContent = '‚òÄÔ∏è';
  }

  btn.addEventListener('click', () => {
    const isLight = root.classList.toggle('light');

    // —Å–æ—Ö—Ä–∞–Ω—è–µ–º
    localStorage.setItem('theme', isLight ? 'light' : 'dark');

    // –æ–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
    btn.textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
  });
})();
</script>
</body>
</html>

